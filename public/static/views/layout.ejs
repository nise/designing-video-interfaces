<!DOCTYPE html>
<html lang="en-US">

<head>
	<title>Designing Video Interfaces</title>
	<meta name='robots' content='noindex,nofollow' />
	<% production=0 %>
		<% if (production) { %>
			<link rel="stylesheet" href="/static/css/video-patterns-style.min.css">
			<script src="/static/js/video-patterns.min.js"></script>
			<% }else{ %>
				<link rel="stylesheet" href="/static/css/bootstrap.min.css">
				<link href="/static/css/bootstrap-switch.min.css" rel="stylesheet">
				<link rel="stylesheet" href="/static/css/colorbox.css">
				<link rel="stylesheet" href="/static/css/video-patterns.css">
				<link rel="stylesheet" type="text/css" href="/static/css/bootstrap-table-filter-control.css">

				<script src='/static/js/jquery-1.11.2.min.js' type='text/javascript'></script>
				<script src="/static/js/bootstrap.min.js"></script>
				<script src="/static/js/bootstrap-switch.min.js"></script>
				<script src="/static/js/showdown.min.js"></script>
				<script src="/static/js/jquery.colorbox-min.js"></script>
				<script src="/static/js/jquery-image-loader.js"></script>
				<script src='/static/js/db.min.js'></script>
				<script src="/static/js/bootstrap-table-all.min.js"></script>
				<!--<script src="/static/js/bootstrap-table-filter-control.min.js"></script>-->
				<script src="/static/js/bootstrap-table-export.min.js"></script>

				<script src="/static/js/FileSaver.min.js" type="text/javascript"></script>
				<script src="/static/js/tableExport.js"></script>
				<script src="/static/js/jquery.base64.js"></script>
				<script src="/static/js/jspdf.js"></script>
				<script src='/static/js/i18next-latest.js'></script>
				<script src='/static/js/moment.min.js'></script>


				<% } %>
					<!--xxx <link href='https://fonts.googleapis.com/css?family=Oswald:400,300,700|Roboto|Droid+Sans:400,700' rel='stylesheet' type='text/css'>-->
					<link href='https://fonts.googleapis.com/css?family=Oswald:400,300,700|Roboto|Droid+Sans:400,700' rel='stylesheet' type='text/css'>
					<script src="/static/js/require.js" data-main="/static/js/requirejs-conf"></script>

					<script type="text/javascript">
						$(document).ready(function () {
							var converter = new showdown.Converter();
							converter.setOption('tables', 'true');
							$('.mark').each(function (i, val) {
								//$(val).html(markdown.toHTML($(val).text()))
								$(val).html(converter.makeHtml($(val).text()));
							});

							$('#searchBtn').click(function () {
								var text = $('#searchField').val();
								$.get('/search/' + text, function (data, status) {
									$("#searchModal").modal(
										{
											position: "absolute",
											top: '80px',
											right: 0,
											bottom: 0,
											left: 0,
											width: "300px",
											"z-index": 10040,
											overflow: "auto",
											"overflow-y": "auto",
											show: true
										}
									);
									$('#searchModal').find('.modal-body').html(data);
								}, 'html');
							});
						});


						/*******************/
						/* INDEXDB*/


						// indexdb via db.js
						var playlist = [], pp = [];
						var server = 0;
						db.open({
							server: 'videopatterns',
							version: 2,
							schema: {
								pattern: {
									key: { keyPath: 'id', autoIncrement: true },
									name: '',
									// Optionally add indexes
									indexes: {
										name: { unique: true },
										answer: { unique: true }
									}
								}
							}
						}).then(function (s) {
							server = s;
						});

						//Components.utils.importGlobalProperties(["indexedDB"]);
						if (window.indexedDB) {
							// From here on, it's like using IndexedDB from content
							var req = indexedDB.open("videopatterns");

							var req2 = window.indexedDB.open("videodatabase", 3);

							req.onerror = function (event) {
								console.log('error');
							};
							req.onsuccess = function (event) {
								console.log('success');
							};
							req2.onerror = function (event) {
								console.log('error2');
							};
							req2.onsuccess = function (event) {
								console.log('success2');
							};

							req.onupgradeneeded = function (event) {
								var db = event.target.result;

								// Create an objectStore to hold information about our customers. We're
								// going to use "ssn" as our key path because it's guaranteed to be
								// unique - or at least that's what I was told during the kickoff meeting.
								var objectStore = db.createObjectStore("playlist", { keyPath: "ssn" });

								// Create an index to search customers by name. We may have duplicates
								// so we can't use a unique index.
								objectStore.createIndex("pattern", "pattern", { unique: true });

								// Use transaction oncomplete to make sure the objectStore creation is 
								// finished before adding data into it.
								objectStore.transaction.oncomplete = function (event) {
									// Store values in the newly created objectStore.
									var customerObjectStore = db.transaction("playlist", "readwrite").objectStore("playlist");
									
									customerObjectStore.add( {pattern: 'bam'} );
									
								};
							};
						}

						/*
						Add pattern to index db
						
						function addToFav(pattern) {
							//playlist.push(pattern.replace(/\ /g, '-').toLowerCase());  
							server.pattern.add({ key: pattern.replace(/\ /g, '-').toLowerCase() }).then(function (item) {
								//alert(JSON.stringify(item));
								// add to  
								console.log('added fav')
								//playlist.push( item.replace(/\ /g,'-').toLowerCase() );  
							}).catch((err) => {// mongoose connection error will be handled here
								console.error('add error:', err);
							});
						}
**/
						/*
						Remove pattern from index db
						
						function removeFav(key) {  //alert('__'+key+'__'); alert(JSON.stringify(pp))
							server.pattern.remove(pp.indexOf(key)).then(function (res) {
								alert('removed ' + JSON.stringify(res));
								fetchAll();
							}).catch((err) => {// mongoose connection error will be handled here
								console.error('remove error:', err.stack);
							});
							// query().filter('name', key).execute()
						}

*/
						/*
						function clear() {
							server.pattern.clear().execute()
								.then(function () {
									alert('cleared index db')
								}).catch((err) => {// mongoose connection error will be handled here
									console.error('clear error:', err.stack);
									
								});
						}
*/


						/*
						 * Fetch all patterns from index db and displays them
						 * status: ok
						 **/
						function fetchAll() {
							server.pattern.query().all()
								.execute()
								.then(function (results) {
									var playlst = {}; playlist = [];
									for (var i = 0; i < results.length; i++) {
										playlst[results[i].name.replace(/\ /g, '-').toLowerCase()] = results[i].name.replace(/\ /g, '-').toLowerCase();
									}
									//
									for (var el in playlst) {
										pp.push(el)
										if (playlst.hasOwnProperty(el)) {
											playlist.push(el);
										}
									}
									// hide patterns that are not part of the playlist
									$('.portfolio-item').each(function (i, val) { //alert( $(val).attr('id') )
										if (playlist.indexOf($(val).attr('id')) == -1) {
											$(val).hide();
										} else { // replace icon
											$(val)
												.find('.add-fav')
												.removeClass('glyphicon-plus')
												.addClass('glyphicon-minus')
												.attr('onclick', '')
												.unbind('click')
												.click(function () {
													alert($(val).find('h5').text())
													removeFav($(val).find('h5').text().replace(/\t|\n|\r|\ /g, ''));
												})
												;
										}
									});

								});
						}




/*
// guided tour
function startIntro(){
        var intro = introJs();
          intro.setOptions({
            steps: [
              {intro: "Herzlich willkommen zur Tour"},
              {
                element: document.querySelector('h1')[0],
                intro: "Willkommen bei der E-Tutoren Qualifizierung!"
              },
              {
                element: document.querySelectorAll('.user-menu')[0],
                intro: "Dies hier ist Ihr Icon. Durch einen Klick können Sie ihr Profil einsehen oder sich ausloggen.",
                position: 'left'
              },
              {
                element: document.querySelectorAll('.scene-view')[0],
                intro: "Hier gehts zum ersten Video der E-Tutoren Qualifizierung",
                position: 'top'
              }
            ]
          }).setOption('doneLabel', 'Nächste Seite').oncomplete(function() {
          	window.location.href = '/videos/view/52a13d2e2aa9d35f24000074';
        	});

          intro.start();
      } 
      	//introJs().setOption('doneLabel', 'Next page').start().oncomplete(function() {
          //window.location.href = 'second.html?multipage=true';
        //});
   //};
*/
					</script>

</head>

<body class="">
	<div id="searchModal" class="modal fade">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal" aria-label="Close">
						<span aria-hidden="true">&times;</span>
					</button>
					<h4 class="modal-title">Search results</h4>
				</div>
				<div class="modal-body">
					<p>One fine body&hellip;</p>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>

				</div>
			</div>
			<!-- /.modal-content -->
		</div>
	</div>
	<header>

		<nav class="navbar navbar-default navbar-fixed-top">
			<div class="container">
				<!-- Brand and toggle get grouped for better mobile display -->
				<div class="navbar-header">
					<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
						<span class="sr-only">Toggle navigation</span>
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>
					</button>
					<a class="navbar-brand" href="/">Designing Video Interfaces
						<small></small>
					</a>
				</div>

				<!-- Collect the nav links, forms, and other content for toggling -->
				<div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
					<ul class="nav navbar-nav">
						<li>
							<a href="/patterns/list">Interaction Design Patterns</a>
						</li>
						<li>
							<a href="/portals">Learning Environments</a>
						</li>
						<!--<li><a href="/framework">Hypervideo.js<span class="sr-only"></span></a></li>-->

						<!--
				    <li class="dropdown">
				      <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">Get involved<span class="caret"></span></a>
				      <ul class="dropdown-menu" role="menu">
								
				        <li class="divider"></li>
				        <li><a href="/proto-patterns/list">Pattern Proposals</a></li>
				        <li class="divider"></li>
				        <li><a href="/vi-two">Apply Patterns</a></li>
				       
				      </ul>
				    </li>-->
					</ul>
					<!--<form class="navbar-form navbar-left" role="search">
				    <div class="form-group">
				      <input type="text" class="form-control" placeholder="Search">
				    </div>
				    <button type="submit" class="btn btn-default">Submit</button>
				  </form>-->
					<ul class="nav navbar-nav navbar-right">
						<!--<li><a href="/getinvolved">Get Involved<span class="sr-only"></span></a></li>-->
						<li>
							<div id="custom-search-input">
								<div class="input-group col-md-12">
									<input id="searchField" type="text" class="form-control input-lg" placeholder="search" />
									<span class="input-group-btn">
										<button id="searchBtn" class="btn btn-info btn-lg" type="button">
											<i class="glyphicon glyphicon-search"></i>
										</button>
									</span>
								</div>
							</div>
						</li>
					</ul>
				</div>
				<!-- /.navbar-collapse -->
			</div>
			<!-- /.container-fluid -->
		</nav>

	</header>

	<content>
		<%- body %>
	</content>
	<footer>
		<% include footer %>
	</footer>

</body>

</html>